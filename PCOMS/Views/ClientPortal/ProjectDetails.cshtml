@model PCOMS.Models.Project

@{
    ViewData["Title"] = Model.Name;
    var totalHours = (decimal)ViewBag.TotalHours;
    var documentCount = (int)ViewBag.DocumentCount;
    var invoices = ViewBag.Invoices as IEnumerable<PCOMS.Application.DTOs.InvoiceDto>;
}

<div class="container-fluid mt-4">
    <!-- Header -->
    <div class="row mb-4">
        <div class="col-md-8">
            <h2><i class="bi bi-folder"></i> @Model.Name</h2>
            <p class="text-muted">Project Details</p>
        </div>
        <div class="col-md-4 text-end">
            <a asp-action="MyProjects" class="btn btn-secondary">
                <i class="bi bi-arrow-left"></i> Back to Projects
            </a>
        </div>
    </div>

    <div class="row">
        <!-- Left Column: Project Info -->
        <div class="col-lg-8">
            <!-- Project Details Card -->
            <div class="card mb-3">
                <div class="card-header">
                    <h5><i class="bi bi-info-circle"></i> Project Information</h5>
                </div>
                <div class="card-body">
                    <dl class="row">
                        <dt class="col-sm-3">Status:</dt>
                        <dd class="col-sm-9">
                            @{
                                var statusBadge = Model.Status switch
                                {
                                    PCOMS.Models.ProjectStatus.Active => "bg-success",
                                    PCOMS.Models.ProjectStatus.Completed => "bg-info",
                                    PCOMS.Models.ProjectStatus.Planned => "bg-secondary",
                                    _ => "bg-secondary"
                                };
                            }
                            <span class="badge @statusBadge">@Model.Status</span>
                        </dd>

                        <dt class="col-sm-3">Description:</dt>
                        <dd class="col-sm-9">
                            @if (!string.IsNullOrEmpty(Model.Description))
                            {
                                @Model.Description
                            }
                            else
                            {
                                <em class="text-muted">No description</em>
                            }
                        </dd>

                        <dt class="col-sm-3">Hourly Rate:</dt>
                        <dd class="col-sm-9">₦@Model.HourlyRate.ToString("N2")/hour</dd>

                        <dt class="col-sm-3">Total Hours:</dt>
                        <dd class="col-sm-9">
                            <strong>@totalHours.ToString("N2")</strong> hours logged
                        </dd>

                        <dt class="col-sm-3">Started:</dt>
                        <dd class="col-sm-9">@Model.CreatedAt.ToString("MMMM dd, yyyy")</dd>

                        <dt class="col-sm-3">Documents:</dt>
                        <dd class="col-sm-9">
                            @documentCount file(s)
                            <a asp-action="MyDocuments" asp-route-projectId="@Model.Id" class="ms-2">
                                View Documents
                            </a>
                        </dd>
                    </dl>
                </div>
            </div>

            <!-- Invoices for this Project -->
            @if (invoices != null && invoices.Any())
            {
                <div class="card">
                    <div class="card-header">
                        <h5><i class="bi bi-receipt"></i> Invoices</h5>
                    </div>
                    <div class="card-body">
                        <div class="table-responsive">
                            <table class="table table-sm">
                                <thead>
                                    <tr>
                                        <th>Invoice #</th>
                                        <th>Date</th>
                                        <th>Due Date</th>
                                        <th class="text-end">Amount</th>
                                        <th>Status</th>
                                        <th></th>
                                    </tr>
                                </thead>
                                <tbody>
                                    @foreach (var invoice in invoices.OrderByDescending(i => i.InvoiceDate))
                                    {
                                        var statusClass = invoice.Status switch
                                        {
                                            "Paid" => "bg-success",
                                            "PartiallyPaid" => "bg-info",
                                            "Overdue" => "bg-danger",
                                            _ => "bg-secondary"
                                        };

                                        <tr>
                                            <td><strong>@invoice.InvoiceNumber</strong></td>
                                            <td>@invoice.InvoiceDate.ToString("MMM dd, yyyy")</td>
                                            <td>@invoice.DueDate.ToString("MMM dd, yyyy")</td>
                                            <td class="text-end">₦@invoice.TotalAmount.ToString("N2")</td>
                                            <td><span class="badge @statusClass">@invoice.Status</span></td>
                                            <td>
                                                <a asp-action="InvoiceDetails" asp-route-id="@invoice.Id"
                                                   class="btn btn-sm btn-outline-primary">
                                                    View
                                                </a>
                                            </td>
                                        </tr>
                                    }
                                </tbody>
                                <tfoot>
                                    <tr class="table-secondary">
                                        <th colspan="3">Total</th>
                                        <th class="text-end">₦@invoices.Sum(i => i.TotalAmount).ToString("N2")</th>
                                        <th colspan="2"></th>
                                    </tr>
                                </tfoot>
                            </table>
                        </div>
                    </div>
                </div>
            }
        </div>

        <!-- Right Column: Quick Stats -->
        <div class="col-lg-4">
            <!-- Stats Card -->
            <div class="card mb-3">
                <div class="card-header bg-primary text-white">
                    <h6 class="mb-0"><i class="bi bi-graph-up"></i> Project Statistics</h6>
                </div>
                <div class="card-body">
                    <div class="mb-3">
                        <h6 class="text-muted">Total Hours Logged</h6>
                        <h3 class="text-primary">@totalHours.ToString("N2")</h3>
                    </div>

                    <div class="mb-3">
                        <h6 class="text-muted">Estimated Value</h6>
                        <h3 class="text-success">₦@((totalHours * Model.HourlyRate).ToString("N2"))</h3>
                    </div>

                    <div class="mb-3">
                        <h6 class="text-muted">Documents</h6>
                        <h3>@documentCount</h3>
                    </div>

                    <div>
                        <h6 class="text-muted">Invoices</h6>
                        <h3>@(invoices?.Count() ?? 0)</h3>
                    </div>
                </div>
            </div>

            <!-- Quick Actions -->
            <div class="card">
                <div class="card-header">
                    <h6 class="mb-0"><i class="bi bi-lightning"></i> Quick Actions</h6>
                </div>
                <div class="list-group list-group-flush">
                    <a asp-action="MyDocuments" asp-route-projectId="@Model.Id"
                       class="list-group-item list-group-item-action">
                        <i class="bi bi-file-earmark me-2"></i> View Documents
                    </a>
                    <a asp-action="MyInvoices" class="list-group-item list-group-item-action">
                        <i class="bi bi-receipt me-2"></i> View All Invoices
                    </a>
                    <a asp-action="Dashboard" class="list-group-item list-group-item-action">
                        <i class="bi bi-speedometer2 me-2"></i> Back to Dashboard
                    </a>
                </div>
            </div>
        </div>
    </div>
</div>
