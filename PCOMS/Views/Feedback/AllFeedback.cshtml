@model IEnumerable<PCOMS.Application.DTOs.ClientFeedbackDto>

@{
    ViewData["Title"] = "Client Feedback";
    var selectedClientId = ViewBag.SelectedClientId;
    var selectedStatus = ViewBag.SelectedStatus;
}

<div class="container-fluid mt-4">
    <div class="row mb-4">
        <div class="col-md-8">
            <h2><i class="bi bi-chat-dots"></i> Client Feedback</h2>
            <p class="text-muted">Review and respond to client feedback</p>
        </div>
        <div class="col-md-4 text-end">
            <a asp-action="Dashboard" class="btn btn-outline-secondary">
                <i class="bi bi-speedometer"></i> Dashboard
            </a>
        </div>
    </div>

    <!-- Filters -->
    <div class="card mb-3">
        <div class="card-body py-2">
            <form method="get" class="row g-2 align-items-end">
                <div class="col-md-4">
                    <label class="form-label small">Client</label>
                    <select name="clientId" asp-items="ViewBag.Clients" class="form-select form-select-sm">
                        <option value="">All Clients</option>
                    </select>
                </div>
                <div class="col-md-3">
                    <label class="form-label small">Status</label>
                    <select name="status" class="form-select form-select-sm">
                        <option value="">All Status</option>
                        <option value="New" selected="@(selectedStatus == "New")">New</option>
                        <option value="Acknowledged" selected="@(selectedStatus == "Acknowledged")">Acknowledged</option>
                        <option value="Resolved" selected="@(selectedStatus == "Resolved")">Resolved</option>
                    </select>
                </div>
                <div class="col-md-3">
                    <button type="submit" class="btn btn-primary btn-sm w-100">
                        <i class="bi bi-funnel"></i> Filter
                    </button>
                </div>
            </form>
        </div>
    </div>

    @if (Model.Any())
    {
        <div class="row">
            @foreach (var feedback in Model)
            {
                var typeColor = feedback.FeedbackType switch
                {
                    "Praise" => "success",
                    "Complaint" => "danger",
                    "Suggestion" => "info",
                    _ => "secondary"
                };

                var statusColor = feedback.Status switch
                {
                    "New" => "warning",
                    "Acknowledged" => "info",
                    "Resolved" => "success",
                    _ => "secondary"
                };

                <div class="col-lg-6 mb-3">
                    <div class="card shadow-sm h-100">
                        <div class="card-header d-flex justify-content-between align-items-center">
                            <div>
                                <span class="badge bg-@typeColor-subtle text-@typeColor me-2">
                                    @if (feedback.FeedbackType == "Praise")
                                    {
                                        <i class="bi bi-hand-thumbs-up"></i>
                                    }
                                    else if (feedback.FeedbackType == "Complaint")
                                    {

                                        <i class="bi bi-exclamation-circle"></i>
                                    }
                                    else if (feedback.FeedbackType == "Suggestion")
                                    {

                                        <i class="bi bi-lightbulb"></i>
                                    }
                                    else
                                    {

                                        <i class="bi bi-chat-dots"></i>
                                    }
                                    @feedback.FeedbackType
                                </span>
                                <span class="badge bg-@statusColor">@feedback.Status</span>
                            </div>
                            @if (feedback.Rating.HasValue)
                            {
                                <div>
                                    @for (int i = 1; i <= 5; i++)
                                    {
                                        <i class="bi @(i <= feedback.Rating ? "bi-star-fill text-warning" : "bi-star text-muted")"></i>
                                    }
                                </div>
                            }
                        </div>
                        <div class="card-body">
                            <h6 class="card-title">@feedback.Subject</h6>
                            <p class="card-text text-muted small">
                                @(feedback.FeedbackText.Length > 150 ? feedback.FeedbackText.Substring(0, 150) + "..." : feedback.FeedbackText)
                            </p>

                            <div class="small text-muted mb-2">
                                <i class="bi bi-person"></i> <strong>@feedback.ClientName</strong>
                                @if (!string.IsNullOrEmpty(feedback.ProjectName))
                                {
                                    <span class="ms-2">
                                        <i class="bi bi-folder"></i> @feedback.ProjectName
                                    </span>
                                }
                            </div>

                            <div class="small text-muted">
                                <i class="bi bi-clock"></i> @feedback.SubmittedAt.ToString("MMM d, yyyy h:mm tt")
                            </div>

                            @if (feedback.Status == "Resolved" && !string.IsNullOrEmpty(feedback.ResponseText))
                            {
                                <div class="mt-3 p-2 bg-light rounded">
                                    <small class="text-muted"><strong>Response:</strong></small>
                                    <p class="small mb-0">@(feedback.ResponseText.Length > 100 ? feedback.ResponseText.Substring(0, 100) + "..." : feedback.ResponseText)</p>
                                </div>
                            }

                            <div class="mt-3">
                                <a asp-action="FeedbackDetails" asp-route-id="@feedback.Id" class="btn btn-sm btn-outline-primary">
                                    <i class="bi bi-eye"></i> View Details
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
            }
        </div>
    }
    else
    {
        <div class="card shadow-sm">
            <div class="card-body text-center py-5">
                <i class="bi bi-chat-dots display-1 text-muted mb-3"></i>
                <h5>No Feedback Found</h5>
                <p class="text-muted">No client feedback matches your filters.</p>
            </div>
        </div>
    }
</div>
