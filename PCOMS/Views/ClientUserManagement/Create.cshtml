@{
    ViewData["Title"] = "Link User to Client";
    var users = ViewBag.Users as IEnumerable<Microsoft.AspNetCore.Identity.IdentityUser>;
    var clients = ViewBag.Clients as IEnumerable<PCOMS.Models.Client>;
}

<div class="container mt-4">
    <div class="row">
        <div class="col-md-8 offset-md-2">
            <div class="card">
                <div class="card-header">
                    <h4><i class="bi bi-link-45deg"></i> Link User to Client</h4>
                </div>
                <div class="card-body">
                    <form asp-action="Create" method="post">
                        @Html.AntiForgeryToken()

                        <div class="alert alert-info">
                            <i class="bi bi-info-circle"></i>
                            <strong>What this does:</strong>
                            <ul class="mb-0">
                                <li>Links a user account to a client company</li>
                                <li>Gives the user the "Client" role</li>
                                <li>User will be able to see that client's projects, invoices, and documents</li>
                            </ul>
                        </div>

                        <div class="mb-3">
                            <label class="form-label">Select User *</label>
                            <select name="userId" class="form-select" required>
                                <option value="">-- Select User Account --</option>
                                @if (users != null && users.Any())
                                {
                                    foreach (var user in users)
                                    {
                                        <option value="@user.Id">@user.Email</option>
                                    }
                                }
                            </select>
                            @if (users == null || !users.Any())
                            {
                                <small class="text-danger">
                                    No available users. All users are already linked or no users exist.
                                </small>
                            }
                        </div>

                        <div class="mb-3">
                            <label class="form-label">Select Client Company *</label>
                            <select name="clientId" class="form-select" required>
                                <option value="">-- Select Client --</option>
                                @if (clients != null && clients.Any())
                                {
                                    foreach (var client in clients)
                                    {
                                        <option value="@client.Id">@client.Name</option>
                                    }
                                }
                            </select>
                            @if (clients == null || !clients.Any())
                            {
                                <small class="text-danger">
                                    No clients found. Please create a client first.
                                </small>
                            }
                        </div>

                        <hr />

                        <div class="d-flex justify-content-between">
                            <a asp-action="Index" class="btn btn-secondary">Cancel</a>
                            <button type="submit" class="btn btn-primary">
                                <i class="bi bi-link"></i> Link User to Client
                            </button>
                        </div>
                    </form>
                </div>
            </div>

            <!-- Instructions -->
            <div class="card mt-3">
                <div class="card-header bg-light">
                    <h6 class="mb-0"><i class="bi bi-lightbulb"></i> How to Use</h6>
                </div>
                <div class="card-body">
                    <ol>
                        <li>Create a user account (if not already created)</li>
                        <li>Create a client company record</li>
                        <li>Use this page to link them together</li>
                        <li>The user can now log in and see their client portal!</li>
                    </ol>

                    <h6 class="mt-3">What the user will see:</h6>
                    <ul>
                        <li>All projects for that client</li>
                        <li>All invoices sent to that client</li>
                        <li>All documents shared with that client</li>
                        <li>Client portal dashboard</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
</div>
