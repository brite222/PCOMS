@model PCOMS.Application.DTOs.CreateProjectFromTemplateDto

@{
    ViewData["Title"] = "Create Project from Template";
    var template = ViewBag.Template as PCOMS.Application.DTOs.ProjectTemplateDto;
    var clients = ViewBag.Clients as IEnumerable<PCOMS.Models.Client>;
}

<div class="container mt-4">
    <div class="row">
        <div class="col-lg-8">
            <div class="card">
                <div class="card-header bg-success text-white">
                    <h4><i class="bi bi-play-fill"></i> Create Project from Template</h4>
                </div>
                <div class="card-body">
                    <form asp-action="UseTemplate" method="post">
                        @Html.AntiForgeryToken()
                        <input type="hidden" asp-for="TemplateId" value="@template.Id" />

                        <div class="alert alert-info">
                            <i class="bi bi-info-circle"></i>
                            <strong>Using Template: @template.Name</strong><br />
                            This will create a new project with @template.Tasks.Count tasks and @template.Milestones.Count milestones.
                        </div>

                        <div class="mb-3">
                            <label asp-for="ProjectName" class="form-label">Project Name *</label>
                            <input asp-for="ProjectName" class="form-control" required
                                   placeholder="e.g., Nike E-commerce Rebuild" />
                            <span asp-validation-for="ProjectName" class="text-danger"></span>
                        </div>

                        <div class="mb-3">
                            <label asp-for="ProjectDescription" class="form-label">Project Description</label>
                            <textarea asp-for="ProjectDescription" class="form-control" rows="3"
                                      placeholder="Optional: Describe this specific project"></textarea>
                        </div>

                        <div class="mb-3">
                            <label asp-for="ClientId" class="form-label">Client *</label>
                            <select asp-for="ClientId" class="form-select" required>
                                <option value="">-- Select Client --</option>
                                @if (clients != null)
                                {
                                    foreach (var client in clients)
                                    {
                                        <option value="@client.Id">@client.Name</option>
                                    }
                                }
                            </select>
                            <span asp-validation-for="ClientId" class="text-danger"></span>
                        </div>

                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label asp-for="StartDate" class="form-label">Start Date *</label>
                                <input asp-for="StartDate" type="date" class="form-control"
                                       value="@DateTime.Today.ToString("yyyy-MM-dd")" required />
                                <span asp-validation-for="StartDate" class="text-danger"></span>
                                <small class="text-muted">All task dates will be calculated from this date</small>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Estimated End Date</label>
                                <input type="text" class="form-control"
                                       value="@DateTime.Today.AddDays(template.EstimatedDurationDays).ToString("MMM dd, yyyy")"
                                       disabled />
                                <small class="text-muted">Approx. @template.EstimatedDurationDays days</small>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label asp-for="Budget" class="form-label">Budget (₦)</label>
                                <input asp-for="Budget" type="number" step="0.01" class="form-control"
                                       placeholder="Default: ₦@template.EstimatedBudget.ToString("N0")" />
                                <small class="text-muted">Leave blank to use template default</small>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label asp-for="HourlyRate" class="form-label">Hourly Rate (₦)</label>
                                <input asp-for="HourlyRate" type="number" step="0.01" class="form-control"
                                       placeholder="Default: ₦@template.DefaultHourlyRate.ToString("N0")" />
                                <small class="text-muted">Leave blank to use template default</small>
                            </div>
                        </div>

                        <hr />

                        <div class="d-flex justify-content-between">
                            <a asp-action="Details" asp-route-id="@template.Id" class="btn btn-secondary">
                                Cancel
                            </a>
                            <button type="submit" class="btn btn-success btn-lg">
                                <i class="bi bi-rocket-takeoff"></i> Create Project
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <!-- Template Preview -->
        <div class="col-lg-4">
            <div class="card">
                <div class="card-header">
                    <h6><i class="bi bi-eye"></i> Template Preview</h6>
                </div>
                <div class="card-body">
                    <h6>@template.Name</h6>
                    <p class="small text-muted">@template.Category</p>

                    <dl class="small">
                        <dt>Tasks:</dt>
                        <dd>@template.Tasks.Count tasks will be created</dd>

                        <dt>Milestones:</dt>
                        <dd>@template.Milestones.Count milestones</dd>

                        <dt>Duration:</dt>
                        <dd>~@template.EstimatedDurationDays days</dd>

                        <dt>Budget:</dt>
                        <dd>₦@template.EstimatedBudget.ToString("N0")</dd>
                    </dl>

                    @if (template.Tasks.Any())
                    {
                        <h6 class="mt-3">Sample Tasks:</h6>
                        <ul class="small">
                            @foreach (var task in template.Tasks.Take(5))
                            {
                                <li>Day @task.DayOffset: @task.Name</li>
                            }
                            @if (template.Tasks.Count > 5)
                            {
                                <li class="text-muted">... and @(template.Tasks.Count - 5) more</li>
                            }
                        </ul>
                    }
                </div>
            </div>

            <div class="alert alert-success mt-3">
                <i class="bi bi-lightning-charge"></i>
                <strong>Quick Setup!</strong><br />
                Your project will be ready in seconds with all tasks and milestones pre-configured.
            </div>
        </div>
    </div>
</div>

@section Scripts {
    @{
        await Html.RenderPartialAsync("_ValidationScriptsPartial");
    }
}
